apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: my-backend
  namespace: api
spec:
  releaseName: my-backend
  chart:
    spec:
      chart: realchart
      sourceRef:
        kind: HelmRepository
        name: devops-helm-charts
      version: "0.1.2"
  interval: 5m
  values:
    name: my-backend
    namespace: api

    serviceAccount:
      # Specifies whether a ServiceAccount should be created
      create: false
      # The name of the ServiceAccount to use.
      # If not set and create is true, a name is generated using the fullname template
      name: ""

    image:
      repository: realmaxwebapp/my_backend # {"$imagepolicy": "flux-system:my-backend-staging:name"}
      tag: 1.0.6 # {"$imagepolicy": "flux-system:my-backend-staging:tag"}

    livenessProbe:
      httpGet:
        path: /health
        port: http
        scheme: HTTP
      initialDelaySeconds: 20

    readinessProbe:
      httpGet:
        path: /health
        port: http
        scheme: HTTP
      initialDelaySeconds: 20

    service:
      port: "8080"
      targetPort: "8080"

    resources:
      limits:
        cpu: 500m
        memory: 1024Mi
      requests:
        cpu: 500m
        memory: 1024Mi

    lifecycle:
      postStart:
        exec:
          command: ["/bin/sh", "-c", "sleep 60"]

    priorityClassName: medium-priority